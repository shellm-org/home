#!/usr/bin/env bash

shellm-source shellm/shellman/lib/shellman.sh

[ $# -eq 0 ] && shellman_usage

main() {
  case "$1" in
    ## \option -h, --help
    ## Print this help and exit.
    -h|--help) shellman "$0"; exit 0 ;;
  esac

  local d dir test_file
  if [ $# -eq 0 ]; then
    dir="${PWD}"
  else
    dir="$1"
    if [ ! -d "${dir}" ]; then
      mkdir -p "${dir}" || return 1
    fi
  fi
  for d in bin lib/env data man/man1 man/man3 tests; do
    mkdir -p "${dir}/$d"
  done

  for test_file in $(basher package-path shellm/home)/tests/{data.bash,test_{shellcheck,shellman}.bats}; do
    cp "${test_file}" "${dir}/tests"
  done

  echo 'shellm-source "env/hello.sh"' > "${dir}/profile"
}

main "$@"
